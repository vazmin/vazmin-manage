<form name="editForm" role="form" (ngSubmit)="save()" #editForm="ngForm">
  <nb-card>
    <nb-card-body>
      <nb-tabset>
        <nb-tab class="mt-3"
                tabTitle="{{ manageUser && manageUser.username != null ? manageUser.username : '' }}{{ manageUser && manageUser.id ? '编辑' : '新增'}}">
          <div *ngIf="manageUser" style="width: 98%">
            <ngx-alert></ngx-alert>
            <ngx-alert-error></ngx-alert-error>
            <div class="row">
              <div class="col-md-2 form-label">
                <span class="text-danger">*&nbsp;</span>
                <label for="username"
                       ngxTranslate="manageUser.username">系统用户名</label>
              </div>
              <div class="col-md-4">
                <div class="form-group">
                  <input type="text" class="form-control" placeholder="请输入{{'manageUser.username'| translate}}"
                         [(ngModel)]="manageUser.username"
                         name="username"
                         #usernameInput="ngModel"
                         [class.form-control-danger]="usernameInput.invalid && usernameInput.touched"
                         autofocus required="required"
                         id="username"
                         [minlength]="5"/>
                  <div *ngIf="usernameInput.touched && usernameInput.invalid">
                    <small class="form-text error"
                           *ngIf="usernameInput.errors?.required"
                           ngxTranslate="entity.validation.required">
                      username不能为空
                    </small>
                  </div>
                </div>
              </div>
            </div>

            <div class="row">
              <div class="col-md-2 form-label">
                <span class="text-danger">*&nbsp;</span>
                <label for="password"
                       ngxTranslate="manageUser.password">登录密码</label>
              </div>
              <div class="col-md-4">
                <div class="form-group">
                  <input type="password" class="form-control" placeholder="请输入{{'manageUser.password'| translate}}"
                         [(ngModel)]="manageUser.password"
                         name="password"
                         #passwordInput="ngModel"
                         [class.form-control-danger]="passwordInput.invalid && passwordInput.touched"
                         [required]="!manageUser.id"
                         id="password"
                         [minlength]="6"
                         [maxlength]="20"/>
                  <div *ngIf="passwordInput.touched && passwordInput.invalid">
                    <small class="form-text error"
                           *ngIf="passwordInput.errors?.required"
                           ngxTranslate="entity.validation.required">
                      password不能为空
                    </small>
                    <small class="form-text error"
                           *ngIf="passwordInput.invalid && passwordInput.touched && (passwordInput.errors?.maxlength || passwordInput.errors?.minlength)">
                      {{'global.messages.validate.newpassword.invalid' |
                        translate:passwordLength}}
                    </small>
                  </div>
                </div>
              </div>
            </div>

            <div class="row">
              <div class="col-md-2 form-label">
                <span class="text-danger">*&nbsp;</span>
                <label for="name" ngxTranslate="manageUser.name">姓名</label>
              </div>
              <div class="col-md-4">
                <div class="form-group">
                  <input type="text" class="form-control" placeholder="请输入{{'manageUser.name'| translate}}"
                         [(ngModel)]="manageUser.name"
                         name="name"
                         #nameInput="ngModel"
                         [class.form-control-danger]="nameInput.invalid && nameInput.touched"
                         required="required"
                         id="name"/>
                  <div *ngIf="nameInput.touched && nameInput.invalid">
                    <small class="form-text error"
                           *ngIf="nameInput.errors?.required"
                           ngxTranslate="entity.validation.required">
                      name不能为空
                    </small>
                  </div>
                </div>
              </div>
            </div>

            <div class="row">
              <div class="col-md-2 form-label">
                <label for="phone" ngxTranslate="manageUser.phone">电话</label>
              </div>
              <div class="col-md-4">
                <div class="form-group">
                  <input type="text" class="form-control" placeholder="请输入{{'manageUser.phone'| translate}}"
                         [(ngModel)]="manageUser.phone"
                         name="phone"
                         #phoneInput="ngModel"
                         [class.form-control-danger]="phoneInput.invalid && phoneInput.touched"
                         id="phone"/>
                </div>
              </div>
            </div>

            <div class="row">
              <div class="col-md-2 form-label">
                <span class="text-danger">*&nbsp;</span>
                <label for="email" ngxTranslate="manageUser.email">业务邮箱</label>
              </div>
              <div class="col-md-4">
                <div class="form-group">
                  <input type="text" class="form-control" placeholder="请输入{{'manageUser.email'| translate}}"
                         [(ngModel)]="manageUser.email"
                         name="email"
                         #emailInput="ngModel"
                         [class.form-control-danger]="emailInput.invalid && emailInput.touched"
                         required="required"
                         id="email"/>
                  <div *ngIf="emailInput.touched && emailInput.invalid">
                    <small class="form-text error"
                           *ngIf="emailInput.errors?.required"
                           ngxTranslate="entity.validation.required">
                      email不能为空
                    </small>
                  </div>
                </div>
              </div>
            </div>


            <div class="row">
              <div class="col-md-2 form-label">
                <label for="memo" ngxTranslate="manageUser.memo">备注</label>
              </div>
              <div class="col-md-4">
                <div class="form-group">
                  <textarea type="text" class="form-control" placeholder="请输入{{'manageUser.memo'| translate}}"
                         [(ngModel)]="manageUser.memo"
                         name="memo"
                         #memoInput="ngModel"
                         [class.form-control-danger]="memoInput.invalid && memoInput.touched"
                         id="memo"></textarea>
                </div>
              </div>
            </div>

            <div class="row">
              <div class="col-md-2 form-label">
                <label for="sendEmail" ngxTranslate="manageUser.sendEmail">是否发送系统邮件</label>
              </div>
              <div class="col-md-4">
                <div class="form-group">
                  <input type="hidden"
                         class="form-control"
                         placeholder="sendEmail"
                         [(ngModel)]="manageUser.sendEmail"
                         name="sendEmail"
                         #sendEmailInput="ngModel"
                         id="sendEmail"/>
                  <ngx-switcher
                      [firstValue]="1"
                      [secondValue]="0"
                      [firstValueLabel]="'是'"
                      [secondValueLabel]="'否'"
                      [value]="+sendEmailInput.value === 1 ? 1 : 0"
                      [colorful]="true"
                      (valueChange)="changeSendEmail($event)"
                  >
                  </ngx-switcher>
                </div>
              </div>
            </div>

            <div class="row">
              <div class="col-md-2 form-label">
                <label for="status" ngxTranslate="manageUser.status">锁定状态</label>
              </div>
              <div class="col-md-4">
                <div class="form-group">
                  <input type="hidden"
                         class="form-control"
                         placeholder="status"
                         [(ngModel)]="manageUser.status"
                         name="status"
                         #statusInput="ngModel"
                         id="status"/>
                  <ngx-switcher
                      [firstValue]="1"
                      [secondValue]="0"
                      [firstValueLabel]="'可用'"
                      [secondValueLabel]="'禁用'"
                      [value]="+statusInput.value === 1 ? 1 : 0"
                      [colorful]="true"
                      (valueChange)="changeStatus($event)"
                  >
                  </ngx-switcher>
                </div>
              </div>
            </div>
          </div>
        </nb-tab>
        <nb-tab class="mt-3" tabTitle="为用户分配角色">
          <ngx-alert></ngx-alert>
          <ngx-alert-error></ngx-alert-error>
          <div *ngIf="roleList">
            <div *ngFor="let role of roleList; let index = index">
              <div class="custom-control custom-checkbox">
                <input name="role{{index}}" type="checkbox"
                       class="custom-control-input" id="role-cb-{{index}}"
                       [(ngModel)]="roleList[index].checked"
                       [value]="role.checked"
                       [checked]="role.checked"
                >
                <label class="custom-control-label" for="role-cb-{{index}}">
                  {{role.name}} ({{role.memo}})
                </label>
              </div>
            </div>
          </div>
        </nb-tab>
      </nb-tabset>
    </nb-card-body>
    <nb-card-footer>
      <button type="submit" class="btn btn-danger mr-2"
              [disabled]="editForm.form.invalid || submitting"
              ngxTranslate="entity.action.save">保存
      </button>
      <button type="button" (click)="saveAndNew()" class="btn btn-success mr-2"
              [disabled]="editForm.form.invalid || submitting "
              ngxTranslate="entity.action.saveandnew">保存&新增
      </button>
      <button class="btn btn-primary mr-2"
              ngxTranslate="entity.action.back"
              routerLink="/pages/account/user">返回
      </button>
    </nb-card-footer>

  </nb-card>
</form>
